use "test"
use "str"
use "eval"

rats "exit with no args exits with code 0"
  result = eval.file("rats/fixtures/exit_bare.rugo")
  test.assert_eq(result["status"], 0)
end

rats "exit(0) exits with code 0"
  result = eval.file("rats/fixtures/exit_zero.rugo")
  test.assert_eq(result["status"], 0)
end

rats "exit(1) exits with code 1"
  result = eval.file("rats/fixtures/exit_one.rugo")
  test.assert_eq(result["status"], 1)
end

rats "exit(42) exits with code 42"
  result = eval.file("rats/fixtures/exit_42.rugo")
  test.assert_eq(result["status"], 42)
end

rats "exit stops execution"
  result = eval.file("rats/fixtures/exit_stops.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "before")
  test.assert_eq(str.contains(result["output"], "SHOULD NOT PRINT"), false)
end

rats "exit with paren-free syntax"
  result = eval.file("rats/fixtures/exit_paren_free.rugo")
  test.assert_eq(result["status"], 5)
end

rats "exit inside a function"
  result = eval.file("rats/fixtures/exit_in_func.rugo")
  test.assert_eq(result["status"], 3)
  test.assert_eq(str.contains(result["output"], "SHOULD NOT PRINT"), false)
end
