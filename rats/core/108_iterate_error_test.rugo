# RATS: User-friendly error messages for non-iterable values
use "test"
use "eval"

# --- Iterating over a function should give a friendly error ---

rats "for-in over module function gives friendly error"
  source = <<~RUGO
    use "os"
    for arg in os.args
    end
  RUGO
  result = eval.run(source)
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "cannot iterate over a function")
end

rats "for-in over lambda gives friendly error"
  source = <<~RUGO
    f = fn(x) x end
    for x in f
    end
  RUGO
  result = eval.run(source)
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "cannot iterate over a function")
end

# --- Iterating over other non-iterable types ---

rats "for-in over string gives friendly error"
  source = <<~RUGO
    for ch in "hello"
    end
  RUGO
  result = eval.run(source)
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "cannot iterate over string")
end

rats "for-in over bool gives friendly error"
  source = <<~RUGO
    for x in true
    end
  RUGO
  result = eval.run(source)
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "cannot iterate over bool")
end
