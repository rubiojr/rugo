# RATS: Test Go bridge — encoding/json package (1:1 mapping)
# json.Marshal accepts any — the bridge normalizes Rugo hashes via rugo_to_go.
# json.Unmarshal requires a pointer arg (not bridgeable 1:1) — use "json" module instead.
use "test"

import "encoding/json"

rats "json.marshal hash"
  result = json.marshal({name: "Rugo", version: 1})
  test.assert_contains(result, "\"name\"")
  test.assert_contains(result, "\"Rugo\"")
  test.assert_contains(result, "\"version\"")
end

rats "json.marshal string"
  test.assert_eq(json.marshal("hello"), "\"hello\"")
end

rats "json.marshal array"
  test.assert_eq(json.marshal([1, 2, 3]), "[1,2,3]")
end

rats "json.marshal nil"
  test.assert_eq(json.marshal(nil), "null")
end

rats "json.marshal boolean"
  test.assert_eq(json.marshal(true), "true")
  test.assert_eq(json.marshal(false), "false")
end

rats "json.marshal nested hash"
  result = json.marshal({user: {name: "Alice", age: 30}})
  test.assert_contains(result, "\"user\"")
  test.assert_contains(result, "\"Alice\"")
end

rats "json.marshal array of hashes"
  result = json.marshal([{a: 1}, {b: 2}])
  test.assert_contains(result, "\"a\"")
  test.assert_contains(result, "\"b\"")
end

rats "json.marshal_indent"
  result = json.marshal_indent({name: "Rugo"}, "", "  ")
  test.assert_contains(result, "\"name\"")
  test.assert_contains(result, "\"Rugo\"")
  test.assert_contains(result, "\n")
end

rats "json.valid with valid JSON"
  test.assert_true(json.valid("{}"))
  test.assert_true(json.valid("[1,2,3]"))
  test.assert_true(json.valid("\"hello\""))
  test.assert_true(json.valid("null"))
end

rats "json.valid with invalid JSON"
  test.assert_false(json.valid("not json"))
  test.assert_false(json.valid("{bad}"))
  test.assert_false(json.valid(""))
end

rats "json.marshal empty hash"
  test.assert_eq(json.marshal({}), "{}")
end

rats "json.marshal empty array"
  test.assert_eq(json.marshal([]), "[]")
end

rats "json.marshal mixed array"
  result = json.marshal([1, "two", true, nil])
  test.assert_eq(result, "[1,\"two\",true,null]")
end

rats "json.marshal integer"
  test.assert_eq(json.marshal(42), "42")
end

rats "json.marshal float"
  test.assert_eq(json.marshal(3.14), "3.14")
end
