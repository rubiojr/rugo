# RATS: Test Go bridge â€” sort, time, os packages
use "test"
use "str"
use "conv"

import "sort"
import "time"
import "os" as go_os

# sort
rats "sort.strings"
  arr = ["banana", "apple", "cherry"]
  sort.strings(arr)
  test.assert_eq(arr[0], "apple")
  test.assert_eq(arr[1], "banana")
  test.assert_eq(arr[2], "cherry")
end

rats "sort.ints"
  arr = [3, 1, 2]
  sort.ints(arr)
  test.assert_eq(conv.to_s(arr[0]), "1")
  test.assert_eq(conv.to_s(arr[1]), "2")
  test.assert_eq(conv.to_s(arr[2]), "3")
end

rats "sort.is_sorted"
  test.assert_true(sort.is_sorted(["apple", "banana", "cherry"]))
  test.assert_false(sort.is_sorted(["cherry", "apple"]))
end

# time
rats "time.now_unix"
  ts = time.now_unix()
  test.assert_true(ts > 0)
end

rats "time.sleep_ms"
  start = time.now_unix_nano()
  time.sleep_ms(50)
  elapsed = time.now_unix_nano() - start
  test.assert_true(elapsed > 40000000)
end

# os (Go bridge with alias)
rats "os bridge getenv with alias"
  home = go_os.getenv("HOME")
  test.assert_neq(home, "")
end

rats "os bridge getwd"
  cwd = go_os.getwd()
  test.assert_neq(cwd, "")
end

rats "os bridge hostname"
  h = go_os.hostname()
  test.assert_neq(h, "")
end

rats "os bridge temp_dir"
  test.assert_contains(go_os.temp_dir(), "tmp")
end

rats "os bridge read_file"
  content = go_os.read_file("/etc/os-release")
  test.assert_neq(content, "")
end

rats "os bridge write_file"
  path = test.tmpdir() + "/rugo_test_write_file.txt"
  go_os.write_file(path, "hello from rugo", 0644)
  content = go_os.read_file(path)
  test.assert_eq(str.trim(content), "hello from rugo")
  go_os.remove(path)
end
