# RATS: Test argument count validation
use "test"
use "eval"

rats "too many arguments"
  source = <<~'RUGO'
    def greet(name)
      puts "Hello " + name
    end
    greet("Alice", "Bob")
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 1)
  test.assert_contains(result["output"], "greet() takes 1 argument but 2 were given")
end

rats "too few arguments"
  source = <<~RUGO
    def add(a, b)
      return a + b
    end
    add(1)
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 1)
  test.assert_contains(result["output"], "add() takes 2 arguments but 1 was given")
end

rats "zero arguments when one expected"
  source = <<~'RUGO'
    def greet(name)
      puts "Hello " + name
    end
    greet()
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 1)
  test.assert_contains(result["output"], "greet() takes 1 argument but none were given")
end

rats "error message does not expose rugofn_ prefix"
  source = <<~'RUGO'
    def greet(name)
      puts "Hello " + name
    end
    greet("Alice", "Bob")
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 1)
  test.assert_contains(result["output"], "greet()")
end

rats "correct argument count works"
  source = <<~RUGO
    def add(a, b)
      return a + b
    end
    puts(add(1, 2))
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "3")
end

rats "zero-param function works with no args"
  source = <<~RUGO
    def hello()
      puts("hi")
    end
    hello()
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "hi")
end
