# RATS: Test Go bridge â€” path/filepath package
use "test"

rats "filepath.base"
  script = <<~SCRIPT
    import "path/filepath"
    puts(filepath.base("/home/user/file.txt"))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "file.txt")
end

rats "filepath.dir"
  script = <<~SCRIPT
    import "path/filepath"
    puts(filepath.dir("/home/user/file.txt"))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "/home/user")
end

rats "filepath.ext"
  script = <<~SCRIPT
    import "path/filepath"
    puts(filepath.ext("file.txt"))
    puts(filepath.ext("file"))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], ".txt")
end

rats "filepath.join"
  script = <<~SCRIPT
    import "path/filepath"
    puts(filepath.join("home", "user", "docs"))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "home/user/docs")
end

rats "filepath.is_abs"
  script = <<~SCRIPT
    import "path/filepath"
    puts(filepath.is_abs("/home/user"))
    puts(filepath.is_abs("relative/path"))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "true")
  test.assert_contains(result["output"], "false")
end

rats "filepath.clean"
  script = <<~SCRIPT
    import "path/filepath"
    puts(filepath.clean("/home/user/../user/./docs"))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "/home/user/docs")
end

rats "filepath.abs"
  script = <<~SCRIPT
    import "path/filepath"
    result = filepath.abs(".")
    puts(result)
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_neq(result["output"], "")
end

rats "filepath.split"
  script = <<~SCRIPT
    import "path/filepath"
    parts = filepath.split("/home/user/file.txt")
    puts(parts[0])
    puts(parts[1])
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "/home/user/")
  test.assert_contains(result["output"], "file.txt")
end
