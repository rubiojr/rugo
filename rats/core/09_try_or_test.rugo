# RATS: Test try/or error handling
use "test"

rats "silent recovery returns nil on failure"
  result = test.run("rugo run rats/fixtures/try_silent.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "<nil>")
end

rats "default value on failure"
  result = test.run("rugo run rats/fixtures/try_default.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "99")
end

rats "handler block on failure"
  result = test.run("rugo run rats/fixtures/try_handler.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "caught:")
  test.assert_contains(result["output"], "42")
end

rats "passes through on success"
  result = test.run("rugo run rats/fixtures/try_success.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "42")
end

rats "shell fallback with try"
  result = test.run("rugo run rats/fixtures/try_shell.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "continued")
end
