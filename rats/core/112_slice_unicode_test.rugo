# RATS: String slicing should operate on characters, not bytes
# Bug: 991df8e â€” string slicing uses byte indices, breaking multibyte characters
use "test"
use "eval"

rats "slice multibyte string gets correct characters"
  s = "hÃ©llo"
  test.assert_eq(s[0, 1], "h")
  test.assert_eq(s[1, 1], "Ã©")
  test.assert_eq(s[2, 3], "llo")
end

rats "slice emoji string"
  s = "ğŸ‰ğŸŠğŸˆ"
  test.assert_eq(s[0, 1], "ğŸ‰")
  test.assert_eq(s[1, 1], "ğŸŠ")
  test.assert_eq(s[2, 1], "ğŸˆ")
  test.assert_eq(s[0, 2], "ğŸ‰ğŸŠ")
end

rats "slice mixed ASCII and multibyte"
  s = "cafÃ©"
  test.assert_eq(s[0, 3], "caf")
  test.assert_eq(s[3, 1], "Ã©")
  test.assert_eq(s[0, 4], "cafÃ©")
end

rats "slice multibyte clamped to string end"
  s = "cafÃ©"
  test.assert_eq(s[2, 100], "fÃ©")
end

rats "slice multibyte start beyond bounds"
  s = "cafÃ©"
  test.assert_eq(s[100, 5], "")
end

rats "slice CJK characters"
  s = "æ—¥æœ¬èª"
  test.assert_eq(s[0, 1], "æ—¥")
  test.assert_eq(s[1, 2], "æœ¬èª")
end
