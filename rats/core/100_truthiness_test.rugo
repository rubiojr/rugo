# RATS: Ruby-like truthiness — only nil and false are falsy
# Bug: ddd4098 — docs say Ruby-like truthiness but implementation is Go-like
use "test"

# --- Integer zero is truthy ---

rats "0 is truthy in if condition"
  result = "falsy"
  if 0
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

rats "0 is truthy in variable condition"
  x = 0
  result = "falsy"
  if x
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

# --- Float zero is truthy ---

rats "0.0 is truthy in if condition"
  result = "falsy"
  if 0.0
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

rats "0.0 is truthy in variable condition"
  x = 0.0
  result = "falsy"
  if x
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

# --- Empty string is truthy ---

rats "empty string is truthy in if condition"
  result = "falsy"
  if ""
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

rats "empty string is truthy in variable condition"
  s = ""
  result = "falsy"
  if s
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

# --- nil and false are still falsy ---

rats "nil is falsy"
  result = "truthy"
  if nil
    result = "truthy"
  else
    result = "falsy"
  end
  test.assert_eq(result, "falsy")
end

rats "false is falsy"
  result = "truthy"
  if false
    result = "truthy"
  else
    result = "falsy"
  end
  test.assert_eq(result, "falsy")
end

# --- Other values remain truthy ---

rats "true is truthy"
  result = "falsy"
  if true
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

rats "non-zero int is truthy"
  result = "falsy"
  if 42
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

rats "non-empty string is truthy"
  result = "falsy"
  if "hello"
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

rats "empty array is truthy"
  result = "falsy"
  if []
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

rats "empty hash is truthy"
  result = "falsy"
  if {}
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

# --- Boolean operators with truthiness ---

rats "0 is truthy in && expression"
  result = "falsy"
  if 0 && true
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

rats "0 is truthy in || expression"
  result = "falsy"
  if false || 0
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

rats "empty string is truthy in && expression"
  result = "falsy"
  if "" && true
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

# --- || returns actual values (Ruby-like) ---

rats "false || string returns the string"
  test.assert_eq(false || "foo", "foo")
end

rats "nil || value returns the value"
  test.assert_eq(nil || 42, 42)
end

rats "truthy || value returns the left side"
  test.assert_eq("hello" || "world", "hello")
end

rats "0 || value returns 0 (0 is truthy)"
  test.assert_eq(0 || "fallback", 0)
end

rats "false || nil returns nil"
  test.assert_eq(false || nil, nil)
end

rats "false || false returns false"
  test.assert_eq(false || false, false)
end

rats "nil || false || string returns the string"
  test.assert_eq(nil || false || "found", "found")
end

# --- && returns actual values (Ruby-like) ---

rats "false && string returns false"
  test.assert_eq(false && "foo", false)
end

rats "nil && value returns nil"
  test.assert_eq(nil && 42, nil)
end

rats "truthy && value returns the right side"
  test.assert_eq("hello" && "world", "world")
end

rats "true && string returns the string"
  test.assert_eq(true && "yes", "yes")
end

rats "string && string && string returns the last"
  test.assert_eq("a" && "b" && "c", "c")
end

# --- || as default value idiom ---

rats "|| provides default for nil variable"
  x = nil
  result = x || "default"
  test.assert_eq(result, "default")
end

rats "|| preserves non-nil value"
  x = "actual"
  result = x || "default"
  test.assert_eq(result, "actual")
end

# --- short-circuit: right side not evaluated when unnecessary ---

rats "|| short-circuits on truthy left"
  # If || didn't short-circuit, this would raise
  result = "ok" || raise("should not reach")
  test.assert_eq(result, "ok")
end

rats "&& short-circuits on falsy left"
  # If && didn't short-circuit, this would raise
  result = false && raise("should not reach")
  test.assert_eq(result, false)
end

# --- Not operator with truthiness ---

rats "!0 is false (since 0 is truthy)"
  result = "truthy"
  if !0
    result = "truthy"
  else
    result = "falsy"
  end
  test.assert_eq(result, "falsy")
end

rats "!nil is true"
  result = "falsy"
  if !nil
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end

# --- While loop with truthiness ---

rats "while with 0 condition runs (0 is truthy, use break)"
  count = 0
  x = 0
  while x
    count += 1
    if count == 3
      break
    end
  end
  test.assert_eq(count, 3)
end

# --- Negative int is truthy ---

rats "negative int is truthy"
  result = "falsy"
  if -1
    result = "truthy"
  end
  test.assert_eq(result, "truthy")
end
