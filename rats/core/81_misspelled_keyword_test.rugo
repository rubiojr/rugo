# Tests for misspelled keyword detection in the preprocessor.
# When a user misspells a keyword (e.g. "requiure" instead of "require"),
# the compiler should suggest the correct keyword instead of falling
# through to shell fallback.

use "test"
use "str"
use "eval"

rats "misspelled require suggests correct keyword"
  source = <<~RUGO
    requiure "github.com/rubiojr/rugh"
  RUGO
  result = eval.run(source)
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "did you mean `require`")
end

rats "misspelled import suggests correct keyword"
  source = <<~RUGO
    imoprt "strings"
  RUGO
  result = eval.run(source)
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "did you mean `import`")
end

rats "misspelled print suggests correct builtin"
  source = <<~RUGO
    printt "hello world"
  RUGO
  result = eval.run(source)
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "did you mean `print`")
end

rats "misspelled keyword error includes the typo"
  source = <<~RUGO
    requiure "github.com/rubiojr/rugh"
  RUGO
  result = eval.run(source)
  test.assert_contains(result["output"], "requiure")
end

rats "valid shell commands are not affected"
  source = <<~RUGO
    echo hello
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "hello")
end
