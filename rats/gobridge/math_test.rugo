# RATS: Test Go bridge â€” math package
use "test"

rats "math.sqrt"
  script = <<~SCRIPT
    import "math"
    use "conv"
    puts(conv.to_s(math.sqrt(16.0)))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "4")
end

rats "math.abs"
  script = <<~SCRIPT
    import "math"
    use "conv"
    puts(conv.to_s(math.abs(-5.0)))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "5")
end

rats "math.ceil and floor"
  script = <<~SCRIPT
    import "math"
    use "conv"
    puts(conv.to_s(math.ceil(3.2)))
    puts(conv.to_s(math.floor(3.8)))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "4")
  test.assert_contains(result["output"], "3")
end

rats "math.pow"
  script = <<~SCRIPT
    import "math"
    use "conv"
    puts(conv.to_s(math.pow(2.0, 10.0)))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "1024")
end

rats "math.round"
  script = <<~SCRIPT
    import "math"
    use "conv"
    puts(conv.to_s(math.round(3.5)))
    puts(conv.to_s(math.round(3.4)))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "4")
  test.assert_contains(result["output"], "3")
end

rats "math.max and min"
  script = <<~SCRIPT
    import "math"
    use "conv"
    puts(conv.to_s(math.max(3.0, 7.0)))
    puts(conv.to_s(math.min(3.0, 7.0)))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "7")
  test.assert_contains(result["output"], "3")
end

rats "math.log and log10"
  script = <<~SCRIPT
    import "math"
    use "conv"
    puts(conv.to_s(math.log(1.0)))
    puts(conv.to_s(math.log10(100.0)))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "0")
  test.assert_contains(result["output"], "2")
end

rats "math.is_nan and nan"
  script = <<~SCRIPT
    import "math"
    puts(math.is_nan(math.nan()))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "true")
end

rats "math.mod"
  script = <<~SCRIPT
    import "math"
    use "conv"
    puts(conv.to_s(math.mod(10.0, 3.0)))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "1")
end
