# RATS: Test negative array indexing
use "test"
use "eval"

rats "negative index reads from end"
  source = <<~RUGO
    arr = [10, 20, 30, 40, 50]
    puts arr[-1]
    puts arr[-2]
    puts arr[-5]
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  lines = result["lines"]
  test.assert_eq(lines[0], "50")
  test.assert_eq(lines[1], "40")
  test.assert_eq(lines[2], "10")
end

rats "negative index assignment"
  source = <<~RUGO
    arr = [1, 2, 3]
    arr[-1] = 99
    puts arr[2]
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "99")
end

rats "negative index -1 returns last element"
  arr = ["a", "b", "c"]
  test.assert_eq(arr[-1], "c")
end

rats "positive indices still work"
  arr = [10, 20, 30]
  test.assert_eq(arr[0], 10)
  test.assert_eq(arr[2], 30)
end

rats "hash with negative integer key still works"
  h = {-1 => "neg"}
  test.assert_eq(h[-1], "neg")
end
