# Tests for comparison operators including string ordering and numeric coercion.

use "test"
use "eval"

rats "string lexicographic less-than"
  source = <<~RUGO
    if "apple" < "banana"
      puts "lt_ok"
    end

    if "zebra" > "yak"
      puts "gt_ok"
    end

    if "cat" >= "cat"
      puts "gte_ok"
    end

    if "ant" <= "bee"
      puts "lte_ok"
    end

    if "ruby" == "ruby"
      puts "eq_ok"
    end

    if "ruby" != "go"
      puts "neq_ok"
    end

    if 1 == 1.0
      puts "int_float_eq"
    end

    if 1 != 2.0
      puts "int_float_neq"
    end
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "lt_ok")
end

rats "string lexicographic greater-than"
  source = <<~RUGO
    if "apple" < "banana"
      puts "lt_ok"
    end

    if "zebra" > "yak"
      puts "gt_ok"
    end

    if "cat" >= "cat"
      puts "gte_ok"
    end

    if "ant" <= "bee"
      puts "lte_ok"
    end

    if "ruby" == "ruby"
      puts "eq_ok"
    end

    if "ruby" != "go"
      puts "neq_ok"
    end

    if 1 == 1.0
      puts "int_float_eq"
    end

    if 1 != 2.0
      puts "int_float_neq"
    end
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "gt_ok")
end

rats "string greater-than-or-equal"
  source = <<~RUGO
    if "apple" < "banana"
      puts "lt_ok"
    end

    if "zebra" > "yak"
      puts "gt_ok"
    end

    if "cat" >= "cat"
      puts "gte_ok"
    end

    if "ant" <= "bee"
      puts "lte_ok"
    end

    if "ruby" == "ruby"
      puts "eq_ok"
    end

    if "ruby" != "go"
      puts "neq_ok"
    end

    if 1 == 1.0
      puts "int_float_eq"
    end

    if 1 != 2.0
      puts "int_float_neq"
    end
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "gte_ok")
end

rats "string less-than-or-equal"
  source = <<~RUGO
    if "apple" < "banana"
      puts "lt_ok"
    end

    if "zebra" > "yak"
      puts "gt_ok"
    end

    if "cat" >= "cat"
      puts "gte_ok"
    end

    if "ant" <= "bee"
      puts "lte_ok"
    end

    if "ruby" == "ruby"
      puts "eq_ok"
    end

    if "ruby" != "go"
      puts "neq_ok"
    end

    if 1 == 1.0
      puts "int_float_eq"
    end

    if 1 != 2.0
      puts "int_float_neq"
    end
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "lte_ok")
end

rats "string equality"
  source = <<~RUGO
    if "apple" < "banana"
      puts "lt_ok"
    end

    if "zebra" > "yak"
      puts "gt_ok"
    end

    if "cat" >= "cat"
      puts "gte_ok"
    end

    if "ant" <= "bee"
      puts "lte_ok"
    end

    if "ruby" == "ruby"
      puts "eq_ok"
    end

    if "ruby" != "go"
      puts "neq_ok"
    end

    if 1 == 1.0
      puts "int_float_eq"
    end

    if 1 != 2.0
      puts "int_float_neq"
    end
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "eq_ok")
end

rats "string inequality"
  source = <<~RUGO
    if "apple" < "banana"
      puts "lt_ok"
    end

    if "zebra" > "yak"
      puts "gt_ok"
    end

    if "cat" >= "cat"
      puts "gte_ok"
    end

    if "ant" <= "bee"
      puts "lte_ok"
    end

    if "ruby" == "ruby"
      puts "eq_ok"
    end

    if "ruby" != "go"
      puts "neq_ok"
    end

    if 1 == 1.0
      puts "int_float_eq"
    end

    if 1 != 2.0
      puts "int_float_neq"
    end
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "neq_ok")
end

rats "int == float numeric coercion"
  source = <<~RUGO
    if "apple" < "banana"
      puts "lt_ok"
    end

    if "zebra" > "yak"
      puts "gt_ok"
    end

    if "cat" >= "cat"
      puts "gte_ok"
    end

    if "ant" <= "bee"
      puts "lte_ok"
    end

    if "ruby" == "ruby"
      puts "eq_ok"
    end

    if "ruby" != "go"
      puts "neq_ok"
    end

    if 1 == 1.0
      puts "int_float_eq"
    end

    if 1 != 2.0
      puts "int_float_neq"
    end
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "int_float_eq")
end

rats "int != float numeric coercion"
  source = <<~RUGO
    if "apple" < "banana"
      puts "lt_ok"
    end

    if "zebra" > "yak"
      puts "gt_ok"
    end

    if "cat" >= "cat"
      puts "gte_ok"
    end

    if "ant" <= "bee"
      puts "lte_ok"
    end

    if "ruby" == "ruby"
      puts "eq_ok"
    end

    if "ruby" != "go"
      puts "neq_ok"
    end

    if 1 == 1.0
      puts "int_float_eq"
    end

    if 1 != 2.0
      puts "int_float_neq"
    end
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "int_float_neq")
end
