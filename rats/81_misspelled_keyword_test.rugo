# Tests for misspelled keyword detection in the preprocessor.
# When a user misspells a keyword (e.g. "requiure" instead of "require"),
# the compiler should suggest the correct keyword instead of falling
# through to shell fallback.

use "test"
use "str"

rats "misspelled require suggests correct keyword"
  result = test.run("rugo run rats/fixtures/misspelled_require.rugo")
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "did you mean `require`")
end

rats "misspelled import suggests correct keyword"
  result = test.run("rugo run rats/fixtures/misspelled_import.rugo")
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "did you mean `import`")
end

rats "misspelled print suggests correct builtin"
  result = test.run("rugo run rats/fixtures/misspelled_puts.rugo")
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "did you mean `print`")
end

rats "misspelled keyword error includes the typo"
  result = test.run("rugo run rats/fixtures/misspelled_require.rugo")
  test.assert_contains(result["output"], "requiure")
end

rats "valid shell commands are not affected"
  result = test.run("rugo run rats/fixtures/valid_shell_command.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "hello")
end
