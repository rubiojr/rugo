# RATS: Test argument count validation
use "test"

rats "too many arguments"
  result = test.run("rugo run rats/fixtures/err_too_many_args.rugo")
  test.assert_eq(result["status"], 1)
  test.assert_contains(result["output"], "greet() takes 1 argument but 2 were given")
end

rats "too few arguments"
  result = test.run("rugo run rats/fixtures/err_too_few_args.rugo")
  test.assert_eq(result["status"], 1)
  test.assert_contains(result["output"], "add() takes 2 arguments but 1 was given")
end

rats "zero arguments when one expected"
  result = test.run("rugo run rats/fixtures/err_zero_args.rugo")
  test.assert_eq(result["status"], 1)
  test.assert_contains(result["output"], "greet() takes 1 argument but none were given")
end

rats "error message does not expose rugofn_ prefix"
  result = test.run("rugo run rats/fixtures/err_too_many_args.rugo")
  test.assert_eq(result["status"], 1)
  test.assert_contains(result["output"], "greet()")
end

rats "correct argument count works"
  script = <<~SCRIPT
    def add(a, b)
      return a + b
    end
    puts(add(1, 2))
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "3")
end

rats "zero-param function works with no args"
  script = <<~SCRIPT
    def hello()
      puts("hi")
    end
    hello()
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "hi")
end
