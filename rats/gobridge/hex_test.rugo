# RATS: Test Go bridge â€” encoding/hex package
use "test"

import "encoding/hex"

rats "hex.encode and decode"
  encoded = hex.encode("Hello!")
  test.assert_eq(encoded, "48656c6c6f21")
  test.assert_eq(hex.decode(encoded), "Hello!")
end

rats "hex.encode known value"
  test.assert_eq(hex.encode("abc"), "616263")
end

# Subprocess: tests exit code on unhandled error
rats "hex.decode error"
  script = <<~SCRIPT
    import "encoding/hex"
    hex.decode("xyz")
  SCRIPT
  test.write_file("#{test.tmpdir()}/test.rugo", script)
  result = test.run("rugo run #{test.tmpdir()}/test.rugo")
  test.assert_eq(result["status"], 1)
  test.assert_contains(result["output"], "hex.decode")
end

rats "hex empty string"
  test.assert_eq(hex.encode(""), "")
  test.assert_eq(hex.decode(""), "")
end

rats "hex round-trip"
  original = "Rugo is great!"
  test.assert_eq(hex.decode(hex.encode(original)), "Rugo is great!")
end
