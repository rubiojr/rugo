# RATS: Test stdlib modules (os, conv, str)
use "test"
use "eval"
use "conv"
use "str"

rats "os.exec runs commands"
  source = <<~RUGO
    use "os"
    result = os.exec("echo hello")
    puts(result)
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "hello")
end

rats "os.exit sets exit code"
  source = <<~RUGO
    use "os"
    os.exit(0)
  RUGO
  result = eval.run(source)
  test.assert_eq(result["status"], 0)
end

rats "conv.to_i converts string to int"
  x = conv.to_i("42")
  test.assert_eq(x + 1, 43)
end

rats "conv.to_s converts int to string"
  x = conv.to_s(42)
  test.assert_eq(x, "42")
end

rats "str.contains works"
  test.assert_eq(str.contains("hello world", "world"), true)
  test.assert_eq(str.contains("hello", "xyz"), false)
end

rats "str.split works"
  arr = str.split("a,b,c", ",")
  test.assert_eq(arr[0], "a")
  test.assert_eq(arr[1], "b")
  test.assert_eq(arr[2], "c")
  test.assert_eq(len(arr), 3)
end

rats "str.trim works"
  test.assert_eq(str.trim("  hello  "), "hello")
end

rats "str.upper and str.lower"
  test.assert_eq(str.upper("hello"), "HELLO")
  test.assert_eq(str.lower("WORLD"), "world")
end

rats "str.join works"
  test.assert_eq(str.join(["a", "b", "c"], ","), "a,b,c")
  test.assert_eq(str.join([], "-"), "")
  test.assert_eq(str.join([1, 2, 3], " + "), "1 + 2 + 3")
end

rats "unknown module import fails"
  source = <<~RUGO
    use "nonexistent"
  RUGO
  result = eval.run(source)
  test.assert_neq(result["status"], 0)
end
