# RATS: Test Go bridge â€” strconv package
use "test"

rats "strconv.atoi"
  script = <<~SCRIPT
    import "strconv"
    use "conv"
    n = strconv.atoi("42")
    puts(conv.to_s(n + 1))
  SCRIPT
  test.write_file(test.tmpdir() + "/test.rugo", script)
  result = test.run("rugo run " + test.tmpdir() + "/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "43")
end

rats "strconv.atoi error panics"
  script = <<~SCRIPT
    import "strconv"
    n = strconv.atoi("not_a_number")
    puts("should not reach here")
  SCRIPT
  test.write_file(test.tmpdir() + "/test.rugo", script)
  result = test.run("rugo run " + test.tmpdir() + "/test.rugo")
  test.assert_neq(result["status"], 0)
end

rats "strconv.itoa"
  script = <<~SCRIPT
    import "strconv"
    puts(strconv.itoa(42))
  SCRIPT
  test.write_file(test.tmpdir() + "/test.rugo", script)
  result = test.run("rugo run " + test.tmpdir() + "/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "42")
end

rats "strconv.format_bool"
  script = <<~SCRIPT
    import "strconv"
    puts(strconv.format_bool(true))
    puts(strconv.format_bool(false))
  SCRIPT
  test.write_file(test.tmpdir() + "/test.rugo", script)
  result = test.run("rugo run " + test.tmpdir() + "/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "true")
  test.assert_contains(result["output"], "false")
end

rats "strconv.parse_bool"
  script = <<~SCRIPT
    import "strconv"
    puts(strconv.parse_bool("true"))
    puts(strconv.parse_bool("1"))
  SCRIPT
  test.write_file(test.tmpdir() + "/test.rugo", script)
  result = test.run("rugo run " + test.tmpdir() + "/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "true")
end

rats "strconv.parse_float"
  script = <<~SCRIPT
    import "strconv"
    use "conv"
    f = strconv.parse_float("3.14", 64)
    puts(conv.to_s(f))
  SCRIPT
  test.write_file(test.tmpdir() + "/test.rugo", script)
  result = test.run("rugo run " + test.tmpdir() + "/test.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "3.14")
end
