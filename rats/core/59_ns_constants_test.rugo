# RATS: Namespaced constants from required files (bug 50d91b4)
use "test"

rats "require'd constant is accessible via namespace"
  result = test.run("rugo run rats/fixtures/ns_const_main.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "hello from lib")
end

rats "sibling function references constant in same required file"
  result = test.run("rugo run rats/fixtures/ns_const_main.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "greeting: hello from lib")
end

rats "require'd constant with alias is accessible"
  result = test.run("rugo run rats/fixtures/ns_const_alias.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "hello from lib")
  test.assert_contains(result["output"], "greeting: hello from lib")
end

rats "require'd file with only constants works"
  result = test.run("rugo run rats/fixtures/ns_const_only_main.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "constants only")
  test.assert_contains(result["output"], "42")
end

rats "constant declaration emits namespaced var"
  result = test.run("rugo emit rats/fixtures/ns_const_main.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_contains(result["output"], "var rugons_ns_const_lib_MY_CONST interface{}")
end
