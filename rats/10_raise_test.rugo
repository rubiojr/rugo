# RATS: Test raise builtin
use "test"

rats "raise exits with error"
  result = test.run("rugo run rats/fixtures/raise_basic.rugo")
  test.assert_neq(result["status"], 0)
  test.assert_contains(result["output"], "something went wrong")
end

rats "raise caught by try/or handler"
  result = test.run("rugo run rats/fixtures/raise_try.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "caught: oops")
end

rats "raise caught by try/or default"
  result = test.run("rugo run rats/fixtures/raise_default.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "safe")
end

rats "raise with no arguments"
  result = test.run("rugo run rats/fixtures/raise_no_args.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "caught: runtime error")
end

rats "raise with paren-free syntax"
  result = test.run("rugo run rats/fixtures/raise_paren_free.rugo")
  test.assert_eq(result["status"], 0)
  test.assert_eq(result["output"], "caught: kaboom")
end
