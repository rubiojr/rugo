# RATS: Test Go bridge â€” path/filepath package
use "test"

import "path/filepath"

rats "filepath.base"
  test.assert_eq(filepath.base("/home/user/file.txt"), "file.txt")
end

rats "filepath.dir"
  test.assert_eq(filepath.dir("/home/user/file.txt"), "/home/user")
end

rats "filepath.ext"
  test.assert_eq(filepath.ext("file.txt"), ".txt")
  test.assert_eq(filepath.ext("file"), "")
end

rats "filepath.join"
  test.assert_eq(filepath.join("home", "user", "docs"), "home/user/docs")
end

rats "filepath.is_abs"
  test.assert_true(filepath.is_abs("/home/user"))
  test.assert_false(filepath.is_abs("relative/path"))
end

rats "filepath.clean"
  test.assert_eq(filepath.clean("/home/user/../user/./docs"), "/home/user/docs")
end

rats "filepath.abs"
  result = filepath.abs(".")
  test.assert_true(len(result) > 0)
end

rats "filepath.split"
  parts = filepath.split("/home/user/file.txt")
  test.assert_eq(parts[0], "/home/user/")
  test.assert_eq(parts[1], "file.txt")
end

rats "filepath.match"
  test.assert_true(filepath.match("*.txt", "file.txt"))
  test.assert_false(filepath.match("*.go", "file.txt"))
end

rats "filepath.rel"
  test.assert_eq(filepath.rel("/home/user", "/home/user/docs/file.txt"), "docs/file.txt")
end

rats "filepath.to_slash and from_slash"
  test.assert_eq(filepath.to_slash("a/b/c"), "a/b/c")
  test.assert_eq(filepath.from_slash("a/b/c"), "a/b/c")
end

rats "filepath.walk_dir callback handles DirEntry"
  dir = test.tmpdir()
  test.write_file("#{dir}/one.txt", "one")
  test.write_file("#{dir}/two.txt", "two")

  count = 0
  saw_one = false
  saw_two = false

  filepath.walk_dir(dir, fn(path, entry, err)
    test.assert_nil(err)
    count = count + 1
    base = filepath.base(path)
    if base == "one.txt"
      saw_one = true
    end
    if base == "two.txt"
      saw_two = true
    end
    return nil
  end)

  test.assert_true(count >= 3)
  test.assert_true(saw_one)
  test.assert_true(saw_two)
end
